<!DOCTYPE html>
{% extends 'dashboard\base_dashboard.html' %}
{% load static %}

<!-- Begin Page Content -->
{% block page_content %}
<div class="container-fluid">

    <!-- Page Heading -->
    <div class="d-sm-flex align-items-center justify-content-between mb-4">
        <h1 class="h3 mb-0 text-gray-800">总览</h1>
        <div style="display:inline;float:right;">
            港元汇率：{{ rate_HKD|floatformat:4 }}，美元汇率：{{ rate_USD|floatformat:4 }}&nbsp;
        </div>
        <a href="#" class="d-none d-sm-inline-block btn btn-sm btn-primary shadow-sm"><i
                class="fas fa-rotate-right fa-sm text-white-50"></i> 刷新</a>
    </div>

    <!-- Content Card Row -->
    <div class="row">

        <!-- 总市值 -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-primary shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-primary text-uppercase mb-1">
                                总市值</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">￥{{ amount_value_sum|floatformat:0 }}</div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-calendar fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 分红收益 -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-success shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                分红收益</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                ￥{{ amount_dividend_sum|floatformat:0 }}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-dollar-sign fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 打新收益 -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-info shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-success text-uppercase mb-1">
                                打新收益</div>
                            <div class="h5 mb-0 font-weight-bold text-gray-800">
                                ￥{{ amount_subscription_sum|floatformat:0 }}
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-money-bill fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 持仓数量 -->
        <div class="col-xl-3 col-md-6 mb-4">
            <div class="card border-left-warning shadow h-100 py-2">
                <div class="card-body">
                    <div class="row no-gutters align-items-center">
                        <div class="col mr-2">
                            <div class="text-xs font-weight-bold text-warning text-uppercase mb-1">
                                持股数量</div>
                            <div class="row no-gutters align-items-center">
                                <div class="col-auto">
                                    <div class="h5 mb-0 mr-3 font-weight-bold text-gray-800">{{ position_number }}</div>
                                </div>
                                <div class="col">
                                    <div class="progress progress-sm mr-2">
                                        <div class="progress-bar bg-info" role="progressbar"
                                            style="width: {{ position_number }}%" aria-valuenow="{{ position_number }}" aria-valuemin="0"
                                            aria-valuemax="100"></div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-auto">
                            <i class="fas fa-clipboard-list fa-2x text-gray-300"></i>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Chart Row -->

    <div class="row">

        <!-- 持仓股票一览 -->
        <div class="col-xl-4 col-lg-4">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">持仓股票一览</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                            aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Dropdown Header:</div>
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                        </div>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div style="height:320px; width:100%; display:block; overflow-y:auto;" class="scrollDiv">
                        <div class="table-responsive">
                            <table class="table table-bordered table-condensed table-striped table-hover list_tab">
                                <thead class="bg-gradient-secondary text-gray-100">
                                    <tr>
                                        <th>股票/代码</th>
                                        <th>价格（元）</th>
                                        <th>涨跌幅</th>
                                        <!--
                                        <th>持仓数量（股）</th>
                                        <th>金额（{{ currency_CNY }}）</th>
                                        <th>百分比</th>
                                        -->
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for i in content %}
                                        <tr>
                                            <td>{{ i.0|stringformat:"s" }}</td>
                                            <td style="text-align: right">{{ i.1|floatformat:3 }}</td>
                                            <td style="text-align: right; color:{{ i.3 }}">{{ i.2 }}</td>
                                            <!--
                                            <td style="text-align: right">{{ i.4|floatformat:0 }}</td>
                                            <td style="text-align: right">{{ i.5|floatformat:0 }}</td>
                                            <td style="text-align: right">{{ i.6 }}</td>
                                            -->
                                        </tr>
                                    {% endfor %}
                                    <!--
                                    <tr>
                                        <td><b>合计</b></td>
                                        <td></td>
                                        <td></td>
                                        <td></td>
                                        <td style="text-align: right"><b>{{ amount_sum|floatformat:0 }}</b></td>
                                        <td style="text-align: right"><b>100.00%</b></td>
                                    </tr>
                                    -->
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 持仓前五占比 -->
        <div class="col-xl-4 col-lg-4">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div
                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">持仓前五占比（{{ top5_percent|floatformat:2 }}%）</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                            aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Dropdown Header:</div>
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                        </div>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div style="height:320px; width:100%; display:block; overflow-y:auto;">
                        <h4 class="small font-weight-bold">{{ content_top5.0.0 }}
                            <span>{{ content_top5.0.5|floatformat:0 }}元</span>
                            <span class="float-right">{{ content_top5.0.6|slice:":-1" }}%</span>
                        </h4>
                        <div class="progress mb-4">
                            <div class="progress-bar bg-primary" role="progressbar" style="width: {{ content_top5.0.6|slice:":-1" }}%"
                                aria-valuenow="{{ content_top5.0.6|slice:":-1" }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <h4 class="small font-weight-bold">{{ content_top5.1.0 }}
                            <span>{{ content_top5.1.5|floatformat:0 }}元</span>
                            <span class="float-right">{{ content_top5.1.6|slice:":-1" }}%</span>
                        </h4>
                        <div class="progress mb-4">
                            <div class="progress-bar bg-success" role="progressbar" style="width: {{ content_top5.1.6|slice:":-1" }}%"
                                aria-valuenow="{{ content_top5.1.6|slice:":-1" }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <h4 class="small font-weight-bold">{{ content_top5.2.0 }}
                            <span>{{ content_top5.2.5|floatformat:0 }}元</span>
                            <span class="float-right">{{ content_top5.2.6|slice:":-1" }}%</span>
                        </h4>
                        <div class="progress mb-4">
                            <div class="progress-bar bg-info" role="progressbar" style="width: {{ content_top5.2.6|slice:":-1" }}%"
                                aria-valuenow="{{ content_top5.2.6|slice:":-1" }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <h4 class="small font-weight-bold">{{ content_top5.3.0 }}
                            <span>{{ content_top5.3.5|floatformat:0 }}元</span>
                            <span class="float-right">{{ content_top5.3.6|slice:":-1" }}%</span>
                        </h4>
                        <div class="progress mb-4">
                            <div class="progress-bar bg-warning" role="progressbar" style="width: {{ content_top5.3.6|slice:":-1" }}%"
                                aria-valuenow="{{ content_top5.3.6|slice:":-1" }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                        <h4 class="small font-weight-bold">{{ content_top5.4.0 }}
                            <span>{{ content_top5.4.5|floatformat:0 }}元</span>
                            <span class="float-right">{{ content_top5.4.6|slice:":-1" }}%</span>
                        </h4>
                        <div class="progress">
                            <div class="progress-bar bg-danger" role="progressbar" style="width: {{ content_top5.4.6|slice:":-1" }}%"
                                aria-valuenow="{{ content_top5.4.6|slice:":-1" }}" aria-valuemin="0" aria-valuemax="100"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 持仓币种占比 -->
        <div class="col-xl-4 col-lg-4">
            <div class="card shadow mb-4">
                <!-- Card Header - Dropdown -->
                <div
                    class="card-header py-3 d-flex flex-row align-items-center justify-content-between">
                    <h6 class="m-0 font-weight-bold text-primary">持仓币种占比</h6>
                    <div class="dropdown no-arrow">
                        <a class="dropdown-toggle" href="#" role="button" id="dropdownMenuLink"
                            data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            <i class="fas fa-ellipsis-v fa-sm fa-fw text-gray-400"></i>
                        </a>
                        <div class="dropdown-menu dropdown-menu-right shadow animated--fade-in"
                            aria-labelledby="dropdownMenuLink">
                            <div class="dropdown-header">Dropdown Header:</div>
                            <a class="dropdown-item" href="#">Action</a>
                            <a class="dropdown-item" href="#">Another action</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="#">Something else here</a>
                        </div>
                    </div>
                </div>
                <!-- Card Body -->
                <div class="card-body">
                    <div style="height:320px; width:100%; display:block; ">
                        <div class="chart-pie pt-4">
                            <canvas id="pie_currency"></canvas>
                        </div>
                        <div class="mt-4 text-center small">
                            <span class="mr-2">
                                <i class="fas fa-circle text-primary"></i> 人民币市值
                            </span>
                            <span class="mr-2">
                                <i class="fas fa-circle text-success"></i> 港元市值
                            </span>
                            <span class="mr-2">
                                <i class="fas fa-circle text-info"></i> 美元市值
                            </span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Content Row -->
    <div class="row">
        <!-- 近期交易 -->
        <div class="col-xl-5 col-lg-5 mb-5">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">近期交易</h6>
                </div>
                <div class="card-body">
                    <div style="height:385px; width:100%; display:block; overflow-y:auto;" class="scrollDiv">
                        <div class="table-responsive">
                            <table class="table table-bordered table-condensed table-striped table-hover list_tab">
                                <thead class="bg-gradient-secondary text-gray-100">
                                    <tr>
                                        <th>日期</th>
                                        <th>股票/代码</th>
                                        <th>类型</th>
                                        <th>价格</th>
                                        <th>数量</th>
                                        <th>金额</th>
                                        <th>结算货币</th>
                                        <th>证券账户</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for trade in trade_list %}
                                        <tr>
                                            <td>{{ trade.trade_date|date:'Y-m-d' }}</td>
                                            <td>{{ trade.stock.stock_name }}({{ trade.stock.stock_code }})</td>
                                            <td>{{ trade.get_trade_type_display }}</td>
                                            <td>{{ trade.trade_price }}</td>
                                            <td>{{ trade.trade_quantity }}</td>
                                            <!-- 模板变量的乘法需要使用widthratio // -->
                                            <td>{% widthratio trade.trade_price 1 trade.trade_quantity %}</td>
                                            <td>{{ trade.get_settlement_currency_display }}</td>
                                            <td>{{ trade.account.account_abbreviation }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 近期分红 -->
        <div class="col-xl-3 col-lg-3 mb-3">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">近期分红</h6>
                </div>
                <div class="card-body">
                    <div style="height:385px; width:100%; display:block; overflow-y:auto;" class="scrollDiv">
                        <div class="table-responsive">
                            <table class="table table-bordered table-condensed table-striped table-hover list_tab">
                                <thead class="bg-gradient-secondary text-gray-100">
                                    <tr>
                                        <th>分红日期</th>
                                        <th>股票/代码</th>
                                        <th>分红金额</th>
                                        <th>证券账户</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% for dividend in dividend_list %}
                                        <tr>
                                            <td>{{ dividend.dividend_date|date:'Y-m-d' }}</td>
                                            <td>{{ dividend.stock.stock_name }}（{{ dividend.stock.stock_code }}）</td>
                                            <td>{{ dividend.dividend_amount|floatformat:0 }}</td>
                                            <td>{{ dividend.account.account_abbreviation }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- 近期打新 -->
        <div class="col-xl-4 col-lg-4 mb-4">
            <div class="card shadow mb-4">
                <div class="card-header py-3">
                    <h6 class="m-0 font-weight-bold text-primary">近期打新</h6>
                </div>
                <div class="card-body">
                    <div style="height:385px; width:100%; display:block; overflow-y:auto;" class="scrollDiv">
                        <div class="table-responsive">
                            <table class="table table-bordered table-condensed table-striped table-hover list_tab">
                                <thead class="bg-gradient-secondary text-gray-100">
                                    <tr>
                                        <th>申购日期</th>
                                        <th>申购名称</th>
                                        <th>申购类型</th>
                                        <th>申购数量</th>
                                        <th>买入价格（元）</th>
                                        <th>卖出价格（元）</th>
                                        <th>证券账户</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    <!--#trade_list即为视图函数list_trade中render传入参数//-->
                                    {% for subscription in subscription_list %}
                                        <tr>
                                            <td>{{ subscription.subscription_date|date:'Y-m-d' }}</td>
                                            <td>{{ subscription.subscription_name }}</td>
                                            <td>{{ subscription.get_subscription_type_display }}</td>
                                            <td>{{ subscription.subscription_quantity|floatformat:0 }}</td>
                                            <td>{{ subscription.buying_price|floatformat:2 }}</td>
                                            <td>{{ subscription.selling_price|floatformat:2 }}</td>
                                            <td>{{ subscription.account.account_abbreviation }}</td>
                                        </tr>
                                    {% endfor %}
                                </tbody>
                            </table>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

</div>


<script>
    var currency_name_array = {{ currency_name_array|safe }};
    var currency_value_array = {{ currency_value_array|safe }};
    window.onload = function() {
        Chart_Pie("pie_currency", currency_name_array, currency_value_array);
    };

</script>


{% endblock %}
<!-- End of Page Content -->
