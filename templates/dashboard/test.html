<!DOCTYPE html>
{% extends 'dashboard/base_dashboard.html' %}
{% block page_content %}
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>基金投资组合可视化分析</title>
{#    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>#}
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', 'Microsoft YaHei', sans-serif;
        }

        body {
            background: linear-gradient(135deg, #f8f9fa 0%, #e9ecef 100%);
            min-height: 100vh;
            padding: 20px;
            color: #343a40;
        }

        .container {
            max-width: 1600px;
            margin: 0 auto;
        }

        .header {
            text-align: center;
            margin-bottom: 30px;
            padding: 20px;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.5rem;
            margin-bottom: 15px;
        }

        .header p {
            color: #6c757d;
            font-size: 1.1rem;
            max-width: 800px;
            margin: 0 auto;
            line-height: 1.6;
        }

        .dashboard {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(500px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .chart-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.08);
            overflow: hidden;
            transition: transform 0.3s ease;
        }

        .chart-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 35px rgba(0, 0, 0, 0.12);
        }

        .card-header {
            background: linear-gradient(135deg, #4c6ef5 0%, #3b5bdb 100%);
            color: white;
            padding: 18px 25px;
            font-size: 1.3rem;
            font-weight: 600;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card-header .card-info {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .chart-container {
            height: 400px;
            width: 100%;
            padding: 15px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 20px;
            margin-bottom: 40px;
        }

        .stat-card {
            background: white;
            border-radius: 15px;
            box-shadow: 0 8px 20px rgba(0, 0, 0, 0.06);
            padding: 25px;
            display: flex;
            flex-direction: column;
            align-items: center;
            text-align: center;
            transition: transform 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-3px);
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
            font-size: 1.8rem;
        }

        .stat-value {
            font-size: 2.2rem;
            font-weight: 700;
            margin-bottom: 10px;
            color: #4c6ef5;
        }

        .stat-label {
            font-size: 1.1rem;
            color: #6c757d;
        }

        .stat-detail {
            margin-top: 15px;
            font-size: 0.95rem;
            color: #495057;
            line-height: 1.6;
        }

        .footer {
            text-align: center;
            padding: 25px;
            color: #6c757d;
            font-size: 0.9rem;
            border-top: 1px solid #e9ecef;
            margin-top: 20px;
        }

        /* 表格样式 */
        .table-container {
            padding: 20px;
            max-height: 400px;
            overflow-y: auto;
        }

        .data-table {
            width: 100%;
            border-collapse: collapse;
            border-radius: 8px;
            overflow: hidden;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.05);
        }

        .data-table th {
            background-color: #f1f3f9;
            padding: 12px 15px;
            text-align: left;
            font-weight: 600;
            color: #495057;
            position: sticky;
            top: 0;
        }

        .data-table td {
            padding: 12px 15px;
            border-bottom: 1px solid #e9ecef;
            color: #495057;
        }

        .data-table tr:last-child td {
            border-bottom: none;
        }

        .data-table tr:hover {
            background-color: #f8f9fa;
        }

        .buy-cell {
            color: #e64980;
            font-weight: 600;
        }

        .sell-cell {
            color: #40c057;
            font-weight: 600;
        }

        .dividend-cell {
            color: #228be6;
            font-weight: 600;
        }

        .table-title {
            margin-bottom: 15px;
            font-size: 1.1rem;
            color: #495057;
            font-weight: 600;
            display: flex;
            align-items: center;
        }

        .table-title i {
            margin-right: 10px;
            font-size: 1.2rem;
        }

        @media (max-width: 768px) {
            .dashboard {
                grid-template-columns: 1fr;
            }

            .chart-container {
                height: 350px;
            }

            .header h1 {
                font-size: 2rem;
            }

            .data-table {
                font-size: 0.85rem;
            }

            .data-table th, .data-table td {
                padding: 8px 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>基金投资组合可视化分析</h1>
            <p>全面展示基金资产分布、持仓结构、交易记录和分红情况</p>
        </div>

        <!-- 关键指标卡片 -->
        <div class="stats-grid">
            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(76, 110, 245, 0.15); color: #4c6ef5;">
                    ￥
                </div>
                <div class="stat-value">3,371.84万</div>
                <div class="stat-label">基金总值</div>
                <div class="stat-detail">净值权重: 3.72%</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(40, 167, 69, 0.15); color: #28a745;">
                    ↑
                </div>
                <div class="stat-value">3,358.29万</div>
                <div class="stat-label">市值总和</div>
                <div class="stat-detail">仓位权重: 86.65%</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(255, 193, 7, 0.15); color: #ffc107;">
                    $
                </div>
                <div class="stat-value">909.70万</div>
                <div class="stat-label">累计分红</div>
                <div class="stat-detail">当年分红: 39.75万</div>
            </div>

            <div class="stat-card">
                <div class="stat-icon" style="background: rgba(220, 53, 69, 0.15); color: #dc3545;">
                    ⚡
                </div>
                <div class="stat-value">176.89万</div>
                <div class="stat-label">申购总额</div>
                <div class="stat-detail">股票数: 186 | 债券数: 386</div>
            </div>
        </div>

        <!-- 图表卡片 -->
        <div class="dashboard">
            <!-- 基金资产分布 -->
            <div class="chart-card">
                <div class="card-header">
                    <span>基金资产分布</span>
                    <span class="card-info">币种占比</span>
                </div>
                <div class="chart-container" id="fundDistributionChart"></div>
            </div>

            <!-- 持仓股票市值占比 -->
            <div class="chart-card">
                <div class="card-header">
                    <span>持仓股票市值占比</span>
                    <span class="card-info">前五大持仓占比96.86%</span>
                </div>
                <div class="chart-container" id="holdingChart"></div>
            </div>

            <!-- 市场分布 -->
            <div class="chart-card">
                <div class="card-header">
                    <span>市场分布</span>
                    <span class="card-info">不同市场市值占比</span>
                </div>
                <div class="chart-container" id="marketDistributionChart"></div>
            </div>

            <!-- 持仓股票市值 -->
            <div class="chart-card">
                <div class="card-header">
                    <span>持仓股票市值</span>
                    <span class="card-info">18只持仓股票</span>
                </div>
                <div class="chart-container" id="stockValueChart"></div>
            </div>

            <!-- 分红记录表格 -->
            <div class="chart-card">
                <div class="card-header">
                    <span>分红记录</span>
                    <span class="card-info">最近5笔分红</span>
                </div>
                <div class="table-container">
                    <div class="table-title">
                        <i>📅</i> 分红明细记录
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>股票名称</th>
                                <th>金额(元)</th>
                                <th>账户</th>
                            </tr>
                        </thead>
                        <tbody id="dividendTableBody">
                            <!-- 分红数据将通过JS填充 -->
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- 交易记录表格 -->
            <div class="chart-card">
                <div class="card-header">
                    <span>交易记录</span>
                    <span class="card-info">最近5笔交易</span>
                </div>
                <div class="table-container">
                    <div class="table-title">
                        <i>📊</i> 交易明细记录
                    </div>
                    <table class="data-table">
                        <thead>
                            <tr>
                                <th>日期</th>
                                <th>股票名称</th>
                                <th>操作</th>
                                <th>价格</th>
                                <th>数量</th>
                                <th>金额(元)</th>
                            </tr>
                        </thead>
                        <tbody id="tradeTableBody">
                            <!-- 交易数据将通过JS填充 -->
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <div class="footer">
            数据更新时间: 2025-08-15 16:10:57 | 可视化分析系统 v2.0
        </div>
    </div>

    <script>
        // 基金数据
        const fundData = {
            funds_value_sum: 33718359,
            funds_net_value_weighting: 3.7233344477203056,
            market_value_sum: 33582919.45144001,
            position_percent_weighting: 0.8665471400742888,
            dividend_sum: 9097028.839970998,
            current_dividend_sum: 397472.5767,
            current_dividend_percent: 1.1835557574877746,
            subscription_sum: 1768852.05,
            subscription_stock_num: 186,
            subscription_band_num: 386,
            current_subscription_sum: 27185.0,
            current_subscription_stock_num: 2,
            current_subscription_band_num: 0,
            holding_stock_number: 18,
            funds_value_array: [29561213, 2503752, 1653394],
            funds_principal_array: [20000000, 2196649, 1436560],
            funds_currency_array: ["人民币", "港元", "美元"],
            holding_stock_array: [
                ["腾讯控股（00700）", 592.0, 0.0034000000000000002, "#ef4444", 33900, 18445234.080000002, "54.92%", 35],
                ["贵州茅台（600519）", 1422.08, -0.0034000000000000002, "#10b981", 7000, 9954560.0, "29.64%", 26],
                ["银华日利ETF（511880）", 100.801, 0.0001, "#ef4444", 31500, 3175231.5, "9.45%", 93],
                ["分众传媒（002027）", 8.02, 0.005, "#ef4444", 81400, 652828.0, "1.94%", 24],
                ["大全新能源（DQ）", 21.26, -0.0248, "#10b981", 2000, 305412.656, "0.91%", 94],
                ["拼多多（PDD）", 114.74, -0.016200000000000003, "#10b981", 220, 181313.98384, "0.54%", 95],
                ["中国平安（601318）", 59.8, 0.003, "#ef4444", 2400, 143520.0, "0.43%", 2],
                ["H&H国际控股（01112）", 13.13, 0.0718, "#ef4444", 11000, 132745.613, "0.40%", 13],
                ["中国宏桥（01378）", 23.38, 0.0447, "#ef4444", 5500, 118187.069, "0.35%", 10],
                ["古井贡B（200596）", 106.43, -0.0023, "#10b981", 1200, 117383.77560000002, "0.35%", 48],
                ["福耀玻璃（600660）", 55.6, 0.0004, "#ef4444", 2000, 111200.0, "0.33%", 14],
                ["中信银行（00998）", 7.27, -0.0176, "#10b981", 12000, 80182.284, "0.24%", 17],
                ["中国太平（00966）", 18.89, 0.0096, "#ef4444", 3000, 52085.397000000004, "0.16%", 21],
                ["新华保险（01336）", 52.3, 0.0275, "#ef4444", 900, 43262.037000000004, "0.13%", 16],
                ["保利协鑫能源（03800）", 1.25, 0.087, "#ef4444", 30000, 34466.25, "0.10%", 15],
                ["惠理集团（00806）", 2.44, 0.0252, "#ef4444", 8000, 17940.832000000002, "0.05%", 18],
                ["金螳螂（002081）", 3.62, 0.0, "#6b7280", 4000, 14480.0, "0.04%", 23],
                ["中国金茂（00817）", 1.57, 0.0129, "#ef4444", 2000, 2885.974, "0.01%", 22]
            ],
            top5_percent: 96.86,
            top5_array: [
                ["腾讯控股（00700）", 18445234.080000002, "54.92%", "primary", 35],
                ["贵州茅台（600519）", 9954560.0, "29.64%", "secondary", 26],
                ["银华日利ETF（511880）", 3175231.5, "9.45%", "success", 93],
                ["分众传媒（002027）", 652828.0, "1.94%", "info", 24],
                ["大全新能源（DQ）", 305412.656, "0.91%", "warning", 94]
            ],
            market_name_array: "[\"港股\", \"沪市A股\", \"深市A股\", \"美股\", \"深市B股\"]",
            market_value_array: [18926989, 13384511, 667308, 486726, 117383],
            trade_array: [
                ["2025-08-01", "银华日利ETF（511880）", "买入", 100.769, 500, 50384.5, "人民币", "国金1030", 93],
                ["2025-07-30", "新华保险（01336）", "卖出", 52.0, 900, 46800.0, "人民币", "国金1030", 16],
                ["2025-07-23", "银华日利ETF（511880）", "卖出", 100.726, 10000, 1007260.0, "人民币", "国金1030", 93],
                ["2025-07-23", "银华日利ETF（511880）", "卖出", 100.726, 3000, 302178.0, "人民币", "银河6811", 93],
                ["2025-07-23", "银华日利ETF（511880）", "买入", 100.719, 3600, 362588.4, "人民币", "国金7948", 93]
            ],
            dividend_array: [
                ["2025-06-30", "中国平安（601318）", 3888.0, "国金1030", 2],
                ["2025-06-26", "古井贡B（200596）", 6547.0, "银河6811", 48],
                ["2025-06-26", "贵州茅台（600519）", 44277.0, "国金7948", 26],
                ["2025-06-26", "贵州茅台（600519）", 8302.0, "银河6586", 26],
                ["2025-06-26", "贵州茅台（600519）", 141132.0, "银河6811", 26]
            ],
            subscription_array: [
                ["2025-07-07", "华电新能", "股票", 500, 2210.0, 138.9937106918239, "国金1030"],
                ["2025-07-07", "华电新能", "股票", 5000, 24975.0, 157.0754716981132, "国金7948"],
                ["2024-12-19", "国货航", "股票", 500, 4085.0, 355.2173913043478, "华泰8120"],
                ["2024-11-18", "领益转债", "可转债", 10, 235.16, 23.516, "华泰3479"],
                ["2024-11-07", "嘉益转债", "可转债", 10, 190.45, 19.045, "国金1030"]
            ],
            modified_time: "2025-08-15 16:10:57"
        };

        // 初始化所有图表
        document.addEventListener('DOMContentLoaded', function() {
            // 基金资产分布图
            const fundChart = echarts.init(document.getElementById('fundDistributionChart'));
            fundChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c}万 ({d}%)'
                },
                legend: {
                    orient: 'vertical',
                    right: 10,
                    top: 'center',
                    textStyle: {
                        fontSize: 12
                    }
                },
                series: [{
                    name: '基金资产分布',
                    type: 'pie',
                    radius: ['40%', '70%'],
                    center: ['40%', '50%'],
                    avoidLabelOverlap: false,
                    itemStyle: {
                        borderRadius: 10,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        show: false,
                        position: 'center'
                    },
                    emphasis: {
                        label: {
                            show: true,
                            fontSize: 18,
                            fontWeight: 'bold'
                        }
                    },
                    labelLine: {
                        show: false
                    },
                    data: [
                        { value: (fundData.funds_value_array[0]/10000).toFixed(2), name: '人民币', itemStyle: { color: '#4c6ef5' } },
                        { value: (fundData.funds_value_array[1]/10000).toFixed(2), name: '港元', itemStyle: { color: '#ff922b' } },
                        { value: (fundData.funds_value_array[2]/10000).toFixed(2), name: '美元', itemStyle: { color: '#40c057' } }
                    ]
                }]
            });

            // 持仓股票市值占比
            const holdingChart = echarts.init(document.getElementById('holdingChart'));
            holdingChart.setOption({
                tooltip: {
                    trigger: 'item',
                    formatter: '{b}: {c}万 ({d}%)'
                },
                legend: {
                    bottom: 10,
                    left: 'center',
                    textStyle: {
                        fontSize: 11
                    }
                },
                series: [{
                    name: '持仓市值占比',
                    type: 'pie',
                    radius: '65%',
                    center: ['50%', '45%'],
                    itemStyle: {
                        borderRadius: 5,
                        borderColor: '#fff',
                        borderWidth: 2
                    },
                    label: {
                        formatter: '{b|{b}}\n{c}万',
                        rich: {
                            b: {
                                fontSize: 12,
                                lineHeight: 20
                            }
                        }
                    },
                    emphasis: {
                        itemStyle: {
                            shadowBlur: 10,
                            shadowOffsetX: 0,
                            shadowColor: 'rgba(0, 0, 0, 0.5)'
                        }
                    },
                    data: [
                        { value: (18445234.08/10000).toFixed(2), name: '腾讯控股（00700）', itemStyle: { color: '#4c6ef5' } },
                        { value: (9954560/10000).toFixed(2), name: '贵州茅台（600519）', itemStyle: { color: '#ff922b' } },
                        { value: (3175231.5/10000).toFixed(2), name: '银华日利ETF（511880）', itemStyle: { color: '#40c057' } },
                        { value: (652828/10000).toFixed(2), name: '分众传媒（002027）', itemStyle: { color: '#fab005' } },
                        { value: (305412.656/10000).toFixed(2), name: '大全新能源（DQ）', itemStyle: { color: '#e64980' } },
                        { value: (138.75), name: '其他持仓', itemStyle: { color: '#adb5bd' } }
                    ]
                }]
            });

            // 市场分布图
            const marketChart = echarts.init(document.getElementById('marketDistributionChart'));
            marketChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'category',
                    data: ['港股', '沪市A股', '深市A股', '美股', '深市B股'],
                    axisLabel: {
                        interval: 0,
                        rotate: 0
                    }
                },
                yAxis: {
                    type: 'value',
                    name: '市值（万元）'
                },
                series: [{
                    name: '市值',
                    type: 'bar',
                    barWidth: '60%',
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(0, 0, 0, 1, [
                            { offset: 0, color: '#4c6ef5' },
                            { offset: 1, color: '#3b5bdb' }
                        ]),
                        borderRadius: [5, 5, 0, 0]
                    },
                    data: [
                        fundData.market_value_array[0]/10000,
                        fundData.market_value_array[1]/10000,
                        fundData.market_value_array[2]/10000,
                        fundData.market_value_array[3]/10000,
                        fundData.market_value_array[4]/10000
                    ]
                }]
            });

            // 持仓股票市值图
            const stockChart = echarts.init(document.getElementById('stockValueChart'));
            stockChart.setOption({
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'shadow'
                    },
                    formatter: function(params) {
                        return `${params[0].name}<br/>市值: ${params[0].value}万元<br/>占比: ${params[0].data[2]}`;
                    }
                },
                grid: {
                    left: '3%',
                    right: '4%',
                    bottom: '3%',
                    containLabel: true
                },
                xAxis: {
                    type: 'value',
                    name: '市值（万元）'
                },
                yAxis: {
                    type: 'category',
                    data: fundData.holding_stock_array.map(item => item[0]),
                    axisLabel: {
                        interval: 0,
                        fontSize: 11
                    }
                },
                series: [{
                    name: '市值',
                    type: 'bar',
                    barWidth: '60%',
                    itemStyle: {
                        color: new echarts.graphic.LinearGradient(1, 0, 0, 0, [
                            { offset: 0, color: '#4c6ef5' },
                            { offset: 1, color: '#748ffc' }
                        ]),
                        borderRadius: [0, 5, 5, 0]
                    },
                    data: fundData.holding_stock_array.map(item => (item[5]/10000).toFixed(2))
                }]
            });

            // 填充分红表格
            const dividendTableBody = document.getElementById('dividendTableBody');
            fundData.dividend_array.forEach(item => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${item[0]}</td>
                    <td>${item[1]}</td>
                    <td class="dividend-cell">${item[2].toLocaleString()}</td>
                    <td>${item[3]}</td>
                `;
                dividendTableBody.appendChild(row);
            });

            // 填充交易表格
            const tradeTableBody = document.getElementById('tradeTableBody');
            fundData.trade_array.forEach(item => {
                const row = document.createElement('tr');
                const operationClass = item[2] === '买入' ? 'buy-cell' : 'sell-cell';
                row.innerHTML = `
                    <td>${item[0]}</td>
                    <td>${item[1]}</td>
                    <td class="${operationClass}">${item[2]}</td>
                    <td>${item[3]}</td>
                    <td>${item[4].toLocaleString()}</td>
                    <td>${item[5].toLocaleString()}</td>
                `;
                tradeTableBody.appendChild(row);
            });

            // 响应式调整
            window.addEventListener('resize', function() {
                fundChart.resize();
                holdingChart.resize();
                marketChart.resize();
                stockChart.resize();
            });
        });
    </script>
</body>
</html>
{% endblock %}