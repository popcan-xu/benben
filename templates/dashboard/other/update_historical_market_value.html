<!DOCTYPE html>
{% extends 'dashboard/base_dashboard.html' %}
{% block page_content %}

<html>
<head>
    <title>任务进度监控</title>
{#    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>#}
</head>
<body>
    <div class="col-xl-12 col-md-6 mb-4">
        <div class="card chart-card">
            <div class="card-header bg-white d-flex justify-content-between align-items-center">
                <h5 class="mb-0">历史持仓数据更新任务</h5>
            </div>
            <div class="card-body p-4">
                <div id="task-progress">
                    <p>当前步骤: <span id="current-step">0</span>/<span id="total-steps">8</span></p>
                    <p>状态: <span id="status">idle</span></p>
                    <p>信息: <span id="message"></span></p>
                    <p>耗时: <span id="duration">0</span> 秒</p>
                </div>
            </div>
        </div>
    </div>

    <script>
    function updateProgress() {
        $.ajax({
            url: "/benben/get_task_status/",  // 确保URL与Django路由匹配
            type: "GET",
            success: function(response) {
                // 更新页面数据
                $('#current-step').text(response.current_step);
                $('#total-steps').text(response.total_steps);
                $('#status').text(response.status);
                $('#message').text(response.message);
                $('#duration').text(response.duration);

                // 任务未完成时继续轮询
                if (response.status === 'running') {
                    setTimeout(updateProgress, 1000);  // 1秒刷新一次
                }
            },
            error: function(xhr) {
                $('#message').text("状态更新失败: " + xhr.statusText);
            }
        });
    }

    // 页面加载后开始轮询
    $(document).ready(function() {
        updateProgress();
    });
    </script>
</body>
</html>
{% endblock %}